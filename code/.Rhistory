rm(list=ls())
gc()
compustat.ciks <- read.delim("~/Dropbox/Research/Text Analysis of Filings/download/data/compustat_ciks.txt")
#cik <- compustat.ciks$cik
#cik <- as.numeric(levels(cik))[cik]
#compustat.ciks$cik <- cik
#compustat.ciks$cik <- unlist(lapply(cik, as.character))
compustat.ciks.list <- data.frame(cik = unique(compustat.ciks$cik))
urls.db <- read.delim("/home/reg/Dropbox/Research/Text Analysis of Filings/download/data/urls-db.txt", stringsAsFactors = FALSE)
urls.db$cik <- as.character(urls.db$cik)
View(urls.db)
#urls.db$cik <- toString(urls.db$cik)
x <- stringr::str_pad(urls.db$cik, 10, pad="0")
#urls.db$cik <- toString(urls.db$cik)
urls.db$cik <- stringr::str_pad(urls.db$cik, 10, pad="0")
## Exclude "ammended" type filings
o <- which(urls.db$formtype %in% c('10-K/A', '10-K405/A', '10-KSB/A', '10-KT/A'))
if(length(o)>0) urls.db <- urls.db[-o, ]
X <- merge(compustat.ciks.list, urls.db, by = c('cik'))
View(compustat.ciks)
compustat.ciks$cik <- stringr::str_pad(compustat.ciks$cik, 10, "left")
compustat.ciks$cik <- stringr::str_pad(compustat.ciks$cik, 10, pad = "0", side = "left")
compustat.ciks$cik <- stringr::str_pad(compustat.ciks$cik, 10, pad = "0")
View(compustat.ciks)
summary(compustat.ciks$cik)
compustat.ciks$cik <- stringr::str_pad(compustat.ciks$cik, 10, pad = "0")
View(compustat.ciks)
View(compustat.ciks)
head(compustat.ciks$cik)
compustat.ciks$cik <- as.numeric(compustat.ciks$cik)
head(compustat.ciks$cik)
compustat.ciks$cik <- stringr::str_pad(compustat.ciks$cik, 10, pad = "0")
compustat.ciks.list <- data.frame(cik = unique(compustat.ciks$cik))
X <- merge(compustat.ciks.list, urls.db, by = c('cik'))
DATA_DIR <- "/home/reg/Dropbox/Research/Text Analysis of Filings/download/data"
urls.db <- read.delim(paste(DATA_DIR,"urls-db.txt",sep='/'), stringsAsFactors = FALSE)
outfilename <- paste(DATA_DIR, "compustat-urls-db.txt", sep = "/")
write.table(x=X, file = outfilename, sep="\t", quote=FALSE, row.names = FALSE)
# Write just URLs to file
outfilename <- paste(DATA_DIR, "compustat-urls.txt", sep = "/")
write.table(x=X$url, file = outfilename, sep="\t", quote=FALSE,
row.names = FALSE, col.names = FALSE)
compustat.ciks <- read.delim(paste(DATA_DIR, compustat_ciks.txt, sep = '/'))
compustat.ciks <- read.delim(paste(DATA_DIR, "compustat_ciks.txt", sep = '/'))
## Reginald Edwards
## 02 June 2017
## 02 March 2018
## Reads in a dataset with COMPUSTAT CIKs and associated metadata for downloading filings from EDGAR.
## Filters urls not asoociated with a COMPUSTAT CIK
## TODO:
## - rewrite in python
rm(list=ls())
library('stringr')
DATA_DIR <- "/home/reg/Dropbox/Research/Text Analysis of Filings/download/data"
compustat.ciks <- read.delim(paste(DATA_DIR, "compustat_ciks.txt", sep = '/'))
compustat.ciks$cik <- as.numeric(compustat.ciks$cik)
compustat.ciks$cik <- stringr::str_pad(compustat.ciks$cik, 10, pad = "0")
compustat.ciks.list <- data.frame(cik = unique(compustat.ciks$cik))
urls.db <- read.delim(paste(DATA_DIR,"urls-db.txt",sep='/'), stringsAsFactors = FALSE)
urls.db$cik <- as.character(urls.db$cik)
#urls.db$cik <- toString(urls.db$cik)
urls.db$cik <- stringr::str_pad(urls.db$cik, 10, pad="0")
## Exclude "ammended" type filings
o <- which(urls.db$formtype %in% c('10-K/A', '10-K405/A', '10-KSB/A', '10-KT/A'))
if(length(o)>0) urls.db <- urls.db[-o, ]
X <- merge(compustat.ciks.list, urls.db, by = c('cik'))
outfilename <- paste(DATA_DIR, "compustat-urls-db.txt", sep = "/")
write.table(x=X, file = outfilename, sep="\t", quote=FALSE, row.names = FALSE)
# Write just URLs to file
outfilename <- paste(DATA_DIR, "compustat-urls.txt", sep = "/")
write.table(x=X$url, file = outfilename, sep="\t", quote=FALSE,
row.names = FALSE, col.names = FALSE)
